<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomePro Admin - Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Kanit', sans-serif; }
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .status-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 0.8rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900">

<nav class="bg-white text-slate-800 sticky top-0 z-50 shadow-md border-b border-slate-100">
    <div class="max-w-[1600px] mx-auto px-4 lg:px-8">
        <div class="flex items-center justify-between h-20">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-tr from-orange-400 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i data-lucide="shield-check" class="text-white w-6 h-6"></i>
                </div>
                <span class="text-2xl font-bold tracking-tight text-[#002d72]">ORDER<span class="text-orange-500">HUB</span></span>
            </div>

            <div class="hidden md:flex items-center gap-4">
                <a href="#" class="flex items-center gap-2 py-2 px-4 bg-orange-500 text-white rounded-lg shadow-md hover:bg-orange-600 transition-all">
                    <i data-lucide="shopping-bag" class="w-4 h-4"></i>
                    <span class="text-sm font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
                </a>
                <a href="index.html" target="_blank" class="flex items-center gap-2 py-2 px-4 text-slate-600 hover:text-[#002d72] transition-all">
                    <i data-lucide="external-link" class="w-4 h-4"></i>
                    <span class="text-sm font-medium">‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </a>
            </div>

            <div class="flex items-center gap-2 sm:gap-4">
                <button onclick="fetchOrders()" class="flex items-center gap-2 bg-slate-100 hover:bg-slate-200 border border-slate-200 px-3 py-2 rounded-lg transition-all text-slate-700">
                    <i data-lucide="refresh-cw" class="w-4 h-4" id="refresh-icon"></i>
                    <span class="hidden lg:inline text-xs font-bold uppercase tracking-wider">Sync</span>
                </button>
                
                <div class="flex items-center gap-3 pl-2 sm:pl-4 border-l border-slate-200">
                    <div class="hidden sm:block text-right">
                        <p class="text-[10px] text-slate-400 uppercase leading-none font-bold">Admin</p>
                        <p class="text-xs font-semibold text-slate-700">Manager</p>
                    </div>
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-9 h-9 rounded-full border-2 border-orange-500" alt="admin">
                </div>

                <button class="md:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-100 p-4 space-y-3 shadow-inner">
        <a href="#" class="flex items-center gap-3 p-3 bg-orange-50 text-orange-600 rounded-xl font-medium">
            <i data-lucide="shopping-bag" class="w-5 h-5"></i>
            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
        </a>
        <a href="index.html" class="flex items-center gap-3 p-3 text-slate-600 hover:bg-slate-50 rounded-xl font-medium">
            <i data-lucide="external-link" class="w-5 h-5"></i>
            ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
        </a>
    </div>
</nav>

<main class="max-w-[1600px] mx-auto p-4 lg:p-8 space-y-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-slate-800">Order Management</h1>
            <p class="text-sm text-slate-500 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏ö Real-time</p>
        </div>
        
        <div class="flex gap-4">
            <div class="bg-white px-6 py-4 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4 flex-1 sm:flex-none">
                <div class="p-2 bg-blue-50 text-[#002d72] rounded-lg"><i data-lucide="package" class="w-5 h-5"></i></div>
                <div>
                    <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">Orders</p>
                    <h3 id="stat-count" class="text-xl font-bold text-slate-800">0</h3>
                </div>
            </div>
            <div class="bg-white px-6 py-4 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4 flex-1 sm:flex-none">
                <div class="p-2 bg-orange-50 text-orange-600 rounded-lg"><i data-lucide="banknote" class="w-5 h-5"></i></div>
                <div>
                    <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">Revenue</p>
                    <h3 id="stat-revenue" class="text-xl font-bold text-slate-800">‡∏ø0</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
        <div class="overflow-x-auto custom-scroll">
            <table class="w-full text-left border-collapse min-w-[1000px]">
                <thead>
                    <tr class="bg-slate-50 text-slate-400 text-[10px] tracking-[0.15em] font-bold uppercase border-b border-slate-100">
                        <th class="px-6 py-4">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th class="px-6 py-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                        <th class="px-6 py-4">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th> 
                        <th class="px-6 py-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                        <th class="px-6 py-4">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                        <th class="px-6 py-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="px-6 py-4 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="order-list" class="divide-y divide-slate-50 text-sm">
                </tbody>
            </table>
        </div>
        
        <div class="px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between">
            <p class="text-xs text-slate-500 font-medium" id="pagination-info">‡πÅ‡∏™‡∏î‡∏á 0 ‡∏ñ‡∏∂‡∏á 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
            <div class="flex gap-2">
                <button onclick="changePage(-1)" id="prev-btn" class="p-2 rounded-lg border border-slate-200 bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                </button>
                <div id="page-numbers" class="flex gap-1"></div>
                <button onclick="changePage(1)" id="next-btn" class="p-2 rounded-lg border border-slate-200 bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>
</main>

<script>
    const SB_URL = 'https://eodbsetbyryimczkhoaw.supabase.co';
    const SB_KEY = 'sb_publishable_pWCFODdbMNdtx0_tytIXjw_jEry84HD';
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    let currentOrders = [];
    let currentPage = 1;
    const itemsPerPage = 8;

    async function fetchOrders() {
        const list = document.getElementById('order-list');
        const refreshIcon = document.getElementById('refresh-icon');
        
        refreshIcon.classList.add('animate-spin'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
        
        try {
            const { data: orders, error } = await _supabase
                .from('orders')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) throw error;
            
            currentOrders = orders;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Stats
            const totalRevenue = orders.reduce((sum, order) => sum + (order.total_amount || 0), 0);
            document.getElementById('stat-count').innerText = orders.length;
            document.getElementById('stat-revenue').innerText = `‡∏ø${totalRevenue.toLocaleString()}`;

            renderTable();

        } catch (err) { 
            console.error('Fetch Error:', err);
            list.innerHTML = `<tr><td colspan="7" class="p-10 text-center text-rose-500 font-bold">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${err.message}</td></tr>`;
        } finally { 
            refreshIcon.classList.remove('animate-spin');
        }
    }

    function renderTable() {
        const list = document.getElementById('order-list');
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const paginatedOrders = currentOrders.slice(startIndex, endIndex);

        let htmlContent = ''; 

        if (paginatedOrders.length === 0) {
            list.innerHTML = `<tr><td colspan="7" class="p-20 text-center text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</td></tr>`;
            updatePaginationUI();
            return;
        }

        paginatedOrders.forEach((order, index) => {
            const oDate = new Date(order.created_at);
            const dateStr = oDate.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const timeStr = oDate.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', hour12: false });
            
            const items = order.items || [];
            const itemSummary = items.map(i => `${i.name} (x${i.quantity})`).join(', ');

            const statusColors = {
                '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': 'bg-amber-50 text-amber-600 border-amber-200',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á': 'bg-blue-50 text-blue-600 border-blue-200',
                '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß': 'bg-emerald-50 text-emerald-600 border-emerald-200',
                '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': 'bg-rose-50 text-rose-600 border-rose-200'
            };

            htmlContent += `
                <tr class="hover:bg-slate-50 transition-all fade-in" style="animation-delay: ${index * 30}ms">
                    <td class="px-6 py-4">
                        <div class="flex flex-col">
                            <span class="font-bold text-slate-700">${dateStr}</span>
                            <span class="text-[10px] text-slate-400 font-medium">${timeStr} ‡∏ô.</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-800">${order.customer_name}</div>
                        <div class="text-[11px] text-slate-500"><i data-lucide="phone" class="inline w-3 h-3"></i> ${order.customer_phone}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="max-w-[250px] text-xs text-slate-600 italic line-clamp-2">
                            ${order.customer_address || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'}
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="max-w-[200px] truncate text-slate-600 text-xs">${itemSummary}</div>
                        <div class="text-[9px] text-slate-400 font-bold uppercase">#${order.id.toString().slice(-6)}</div>
                    </td>
                    <td class="px-6 py-4 text-base font-bold text-slate-900">‡∏ø${(order.total_amount || 0).toLocaleString()}</td>
                    <td class="px-6 py-4">
                        <select onchange="updateStatus(${order.id}, this.value)" 
                            class="status-select text-[11px] font-bold rounded-lg px-3 py-1.5 border transition-all ${statusColors[order.status] || 'bg-slate-50 text-slate-600'}">
                            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${order.status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" ${order.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á' ? 'selected' : ''}>üöö ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
                            <option value="‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ${order.status === '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${order.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex justify-center gap-2">
                            <button onclick="printReceipt(${order.id})" class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                <i data-lucide="printer" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteOrder(${order.id}, '${order.customer_name}')" class="p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
        });

        list.innerHTML = htmlContent;
        lucide.createIcons();
        updatePaginationUI();
    }

    function updatePaginationUI() {
        const totalItems = currentOrders.length;
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        const startIndex = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
        const endIndex = Math.min(currentPage * itemsPerPage, totalItems);

        document.getElementById('pagination-info').innerText = `‡πÅ‡∏™‡∏î‡∏á ${startIndex} ‡∏ñ‡∏∂‡∏á ${endIndex} ‡∏à‡∏≤‡∏Å ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        
        document.getElementById('prev-btn').disabled = currentPage === 1;
        document.getElementById('next-btn').disabled = currentPage === totalPages || totalPages === 0;

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÜ
        const pageNumbers = document.getElementById('page-numbers');
        pageNumbers.innerHTML = '';
        if(totalPages > 1) {
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = `px-3 py-1 rounded-md text-xs font-bold transition-all ${i === currentPage ? 'bg-[#002d72] text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`;
                btn.onclick = () => { currentPage = i; renderTable(); };
                pageNumbers.appendChild(btn);
            }
        }
    }

    function changePage(direction) {
        currentPage += direction;
        renderTable();
    }

    async function updateStatus(id, status) {
        try {
            const { error } = await _supabase.from('orders').update({ status }).eq('id', id);
            if (error) throw error;
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ currentOrders ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 1
            const idx = currentOrders.findIndex(o => o.id === id);
            if (idx !== -1) currentOrders[idx].status = status;
            renderTable(); 
        } catch (err) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ: ' + err.message);
        }
    }

    async function deleteOrder(id, name) {
        if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì "${name}"? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`)) return;
        try {
            const { error } = await _supabase.from('orders').delete().eq('id', id);
            if (error) throw error;
            fetchOrders();
        } catch (err) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ: ' + err.message);
        }
    }

    function printReceipt(orderId) {
        const order = currentOrders.find(o => o.id === orderId);
        if (!order) return;
        
        const date = new Date(order.created_at).toLocaleString('th-TH', { 
            day: '2-digit', month: 'long', year: 'numeric', 
            hour: '2-digit', minute: '2-digit' 
        });
        
        const itemsHtml = order.items.map(item => `
            <tr>
                <td style="padding: 10px 0; border-bottom: 1px dashed #eee;">${item.name} (x${item.quantity})</td>
                <td style="padding: 10px 0; text-align: right; border-bottom: 1px dashed #eee;">‡∏ø${(item.price * item.quantity).toLocaleString()}</td>
            </tr>
        `).join('');

        const printWindow = window.open('', '_blank', 'width=800,height=800');
        printWindow.document.write(`
            <html>
                <head>
                    <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô #${order.id}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: 'Kanit', sans-serif; padding: 20px; color: #1e293b; line-height: 1.5; }
                        .receipt-card { max-width: 400px; margin: auto; border: 1px solid #e2e8f0; padding: 30px; border-radius: 15px; }
                        .header { text-align: center; border-bottom: 2px solid #002d72; padding-bottom: 15px; margin-bottom: 15px; }
                        .header h1 { color: #002d72; margin: 0; font-size: 24px; }
                        .info { font-size: 14px; margin-bottom: 20px; }
                        .total { font-size: 20px; font-weight: bold; color: #002d72; display: flex; justify-content: space-between; margin-top: 20px; border-top: 2px solid #eee; pt: 10px; }
                        table { width: 100%; border-collapse: collapse; font-size: 14px; }
                    </style>
                </head>
                <body>
                    <div class="receipt-card">
                        <div class="header">
                            <h1>HOMEPRO</h1>
                            <p style="margin: 5px 0 0 0; color: #64748b;">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</p>
                        </div>
                        <div class="info">
                            <p><strong>Order ID:</strong> #${order.id}</p>
                            <p><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${order.customer_name}</p>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${date}</p>
                        </div>
                        <table>
                            ${itemsHtml}
                        </table>
                        <div class="total">
                            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                            <span>‡∏ø${order.total_amount.toLocaleString()}</span>
                        </div>
                        <p style="text-align: center; font-size: 10px; color: #94a3b8; margin-top: 30px;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.onload = () => { 
            printWindow.print(); 
            printWindow.close(); 
        };
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    fetchOrders();

    // Auto-refresh ‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡∏Å)
    setInterval(fetchOrders, 60000);
</script>

</body>
</html>
